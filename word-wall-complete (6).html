<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Word Wall - Interactive Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .back-to-dashboard {
            position: fixed;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #28a745, #34ce57);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .back-to-dashboard:hover {
            background: linear-gradient(135deg, #34ce57, #40d568);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4b0082, #6a1b9a);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .floating-text-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4b0082, #6a1b9a);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(75, 0, 130, 0.4);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: bold;
        }

        .floating-text-controls.show {
            display: flex;
        }

        .floating-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .floating-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .floating-btn:active {
            transform: scale(0.95);
        }

        .control-section {
            margin-bottom: 15px;
        }

        .top-controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .top-controls .control-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 0;
        }

        .bottom-controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .bottom-controls .control-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 0;
        }

        .control-section h3 {
            color: #4b0082;
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-btn {
            background: linear-gradient(135deg, #4b0082, #6a1b9a);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(75, 0, 130, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(75, 0, 130, 0.4);
        }

        .control-btn:active {
            transform: translateY(0);
        }



        .danger-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .danger-btn:hover {
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .word-wall-container {
            padding: 30px;
            background: white;
            min-height: 600px;
        }

        .custom-word-grid {
            display: grid;
            grid-template-columns: 60px repeat(var(--columns, 6), minmax(120px, 1fr));
            grid-template-rows: 60px repeat(16, 60px);
            gap: 6px;
            width: 100%;
            margin: 0 auto;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Thin scroll bar for the grid */
        .custom-word-grid::-webkit-scrollbar {
            width: 6px;
        }

        .custom-word-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .custom-word-grid::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .custom-word-grid::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .grid-header {
            background: linear-gradient(135deg, #4b0082, #6a1b9a);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(75, 0, 130, 0.3);
        }

        .number-buttons {
            background: linear-gradient(135deg, #1e7e34, #155724);
            color: white;
            border: none;
            font-weight: bold;
            font-size: 24px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(30, 126, 52, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .number-buttons:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 126, 52, 0.4);
        }

        .letter-buttons {
            background: linear-gradient(135deg, #1e7e34, #155724);
            color: white;
            border: none;
            font-weight: bold;
            font-size: 24px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(30, 126, 52, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .letter-buttons:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 126, 52, 0.4);
        }

        .word-cell {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: #4b0082;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 70px;
            max-height: 90px;
            overflow: hidden;
        }

        .word-cell:hover {
            border-color: #4b0082;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(75, 0, 130, 0.2);
        }

        .word-cell.has-word:hover::after {
            content: 'üîä';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            opacity: 0.7;
        }

        .word-cell.editing {
            border-color: #28a745;
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.3);
        }

        .word-cell.empty {
            background: #f8f9fa;
            border-style: dashed;
            color: #6c757d;
            font-style: italic;
        }

        .word-cell.empty:hover {
            background: #e9ecef;
            border-color: #28a745;
        }

        .word-input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: bold;
            color: #4b0082;
            text-align: center;
            outline: none;
            padding: 2px 4px 0px 4px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            line-height: 1.0;
            resize: none;
            overflow: hidden;
            font-family: inherit;
            vertical-align: top;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            box-sizing: border-box;
        }

        .word-cell.font-selected {
            box-shadow: 0 0 0 3px #ff6b35;
            border-radius: 8px;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe8d6 100%);
        }

        .word-input::placeholder {
            color: #6c757d;
            font-style: italic;
            font-weight: normal;
        }

        .selection-btn {
            background: linear-gradient(135deg, #1e7e34, #155724);
            color: white;
            border: none;
            font-weight: bold;
            font-size: 24px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(30, 126, 52, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .selection-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 126, 52, 0.4);
        }

        .selection-btn:active {
            transform: translateY(-1px);
        }

        .selection-btn.selected {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            transform: translateY(-2px);
        }

        .word-cell.hidden {
            opacity: 0.3;
            background: #f8f9fa;
            color: #6c757d;
            pointer-events: none;
        }

        .practice-section {
            padding: 30px;
            background: #f8f9fa;
            text-align: center;
        }

        .practice-section h3 {
            color: #4b0082;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .practice-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .practice-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .practice-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .flash-mode-btn {
            background: linear-gradient(135deg, #ffc107, #ff8f00);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.3);
        }

        .flash-mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
        }

        /* Practice Modal Styles */
        .practice-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 3% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #4b0082, #6a1b9a);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .word-display {
            background: white;
            margin: 30px;
            padding: 60px 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: inset 0 4px 20px rgba(0, 0, 0, 0.1);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .word-number {
            color: #6c757d;
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .current-word {
            font-size: 4rem;
            font-weight: bold;
            color: #4b0082;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 25px;
            height: 12px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            background: linear-gradient(135deg, #28a745, #20c997);
            height: 100%;
            border-radius: 25px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .practice-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 25px;
            justify-content: center;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.1);
            margin: 0 30px;
            border-radius: 15px;
        }

        .timer-label {
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .timer-input {
            background: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #4b0082;
            width: 80px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .timer-input:focus {
            outline: none;
            box-shadow: 0 4px 15px rgba(75, 0, 130, 0.3);
        }

        .flash-toggle {
            background: linear-gradient(135deg, #ffc107, #ff8f00);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);
        }

        .flash-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }

        .flash-toggle.active {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }



        .modal-title-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
        }

        .modal-title-section h2 {
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }

        .countdown-timer {
            position: absolute;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 15px 25px;
            border-radius: 50%;
            font-size: 2rem;
            font-weight: bold;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            animation: pulse 1s infinite;
            z-index: 999;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .order-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-label {
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .order-dropdown {
            background: linear-gradient(135deg, #4b0082, #6a1b9a);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            min-width: 120px;
            box-shadow: 0 3px 10px rgba(75, 0, 130, 0.3);
        }

        .order-dropdown:focus {
            outline: none;
            box-shadow: 0 5px 15px rgba(75, 0, 130, 0.5);
        }

        .order-dropdown option {
            background: #4b0082;
            color: white;
            padding: 10px;
        }

        @media (max-width: 768px) {
            .custom-word-grid {
                grid-template-columns: 35px repeat(var(--columns, 6), minmax(80px, 1fr));
                grid-template-rows: 50px repeat(16, 80px);
                gap: 4px;
                padding: 10px;
                height: 1400px;
                overflow-x: auto;
            }
            
            .container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
            }

            .word-cell {
                font-size: 14px;
                min-height: 70px;
                max-height: 80px;
            }

            .word-input {
                font-size: 14px;
                line-height: 1.1;
            }

            .number-buttons, .letter-buttons, .selection-btn {
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .current-word {
                font-size: 2.5rem;
            }

            .control-buttons {
                justify-content: center;
            }

            .practice-buttons {
                flex-direction: column;
                align-items: center;
            }

            .timer-controls {
                margin: 0 15px;
                padding: 15px;
            }
        }

        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .save-status.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <a href="student-dashboard.html" class="back-to-dashboard">‚Üê Back to Dashboard</a>
    <div class="container">
        <div class="header">
            <h1>üéØ Custom Word Wall</h1>
            <p>Create your own interactive practice words</p>
        </div>

        <!-- Word List Manager Section -->
        <div style="background: linear-gradient(135deg, #4b0082, #6a1b9a); color: white; padding: 20px;">
            <h3 style="color: white; margin-bottom: 15px;">üìö Word List Manager</h3>
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label style="font-weight: bold;">List Name:</label>
                    <input type="text" id="listTitle" placeholder="Enter word list name..." 
                           style="padding: 8px 12px; border: 2px solid white; border-radius: 8px; font-size: 16px; min-width: 200px;"
                           onchange="updateListTitle()">
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label style="font-weight: bold;">Load List:</label>
                    <select id="savedListsDropdown" onchange="loadSelectedList()" 
                            style="padding: 8px 12px; border: 2px solid white; border-radius: 8px; font-size: 16px; min-width: 150px;">
                        <option value="">-- Select a saved list --</option>
                    </select>
                </div>
                <button class="control-btn" onclick="saveCurrentList()" 
                        style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold;">üíæ Save List</button>
                <button class="control-btn" onclick="deleteSelectedList()" 
                        style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold;">üóëÔ∏è Delete List</button>
            </div>
        </div>

        <div class="controls">
            <div class="top-controls">
                <div class="control-section">
                    <h3>üìù Edit Your Words</h3>
                    <div class="control-buttons">
                        <button class="control-btn danger-btn" onclick="clearAllWords()">üóëÔ∏è Clear All</button>
                        <button class="control-btn" onclick="showExportOptions()">üì§ Export</button>
                        <button class="control-btn" onclick="importWords()" title="Import from .txt, .csv, .json files">üì• Import</button>
                        <button class="control-btn" onclick="showWorkbookImport()" title="Import words from any text content" style="background: linear-gradient(135deg, #28a745, #20c997);">üìù Smart Import</button>
                        <input type="file" id="importFile" accept=".json,.txt,.csv,.pdf" style="display: none;" onchange="handleImport(event)">
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        <strong>Smart Import:</strong> Copy and paste any text content - news articles, word lists, PRA Workbook pages, or any copyable text automatically populates the grid<br>
                        <strong>Dictionary:</strong> Right-click or press Ctrl+D (Cmd+D on Mac) while editing a word to see its definition | <strong>Tip:</strong> Grid supports 102 words (17 rows A-Q)
                    </div>
                </div>

                <div class="control-section">
                    <h3>üéØ Practice Selection</h3>
                    <div class="control-buttons">
                        <button class="control-btn selection-btn" onclick="showAllWords()">All Words</button>
                    </div>
                    <div style="margin-top: 10px; color: #4b0082; font-size: 14px; line-height: 1.4;">
                        <strong>How to select:</strong><br>
                        ‚Ä¢ Click a number to select a column<br>
                        ‚Ä¢ Click a letter to select a row<br>
                        ‚Ä¢ Hold Shift + click for multiple selections
                    </div>
                </div>
            </div>

            <div class="bottom-controls">
                <div class="control-section">
                    <h3>üìê Grid Size</h3>
                    <div class="control-buttons">
                        <label style="color: #4b0082; font-weight: bold; margin-right: 8px; font-size: 14px;">Columns:</label>
                        <select id="columnSelector" onchange="changeColumns()" style="padding: 6px; border-radius: 5px; border: 2px solid #4b0082; font-weight: bold; font-size: 14px;">
                            <option value="2">2 Columns</option>
                            <option value="3">3 Columns</option>
                            <option value="4">4 Columns</option>
                            <option value="5">5 Columns</option>
                            <option value="6" selected>6 Columns</option>
                        </select>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üî§ Text Size Controls</h3>
                    
                    <!-- Global Text Size -->
                    <div style="margin-bottom: 10px; padding: 8px; background: #f0f4ff; border-radius: 6px; border-left: 4px solid #4b0082;">
                        <div style="margin-bottom: 5px;">
                            <span style="color: #4b0082; font-weight: bold; font-size: 13px;">üìè Global Text Size (All Boxes):</span>
                        </div>
                        <div class="control-buttons" style="flex-wrap: nowrap;">
                            <button class="control-btn" onclick="adjustGlobalTextSize(-2)">ALL A-</button>
                            <span style="color: #4b0082; font-weight: bold; margin: 0 6px; font-size: 12px; white-space: nowrap;">Smaller</span>
                            <button class="control-btn" onclick="adjustGlobalTextSize(2)">ALL A+</button>
                            <span style="color: #4b0082; font-weight: bold; margin: 0 6px; font-size: 12px; white-space: nowrap;">Bigger</span>
                            <button class="control-btn" onclick="resetGlobalTextSize()">Reset All</button>
                        </div>
                    </div>
                    
                    <!-- Individual Text Size -->
                    <div style="padding: 8px; background: #fff8f0; border-radius: 6px; border-left: 4px solid #ff7d54;">
                        <div style="margin-bottom: 5px;">
                            <span style="color: #4b0082; font-weight: bold; font-size: 13px;">üéØ Individual Box Size (Click box first):</span>
                        </div>
                        <div class="control-buttons" style="flex-wrap: nowrap; overflow-x: auto;">
                            <button class="control-btn" onclick="adjustSelectedCells(-2)">A-</button>
                            <span style="color: #4b0082; font-weight: bold; margin: 0 6px; font-size: 12px; white-space: nowrap;">Make Smaller</span>
                            <button class="control-btn" onclick="adjustSelectedCells(2)">A+</button>
                            <span style="color: #4b0082; font-weight: bold; margin: 0 6px; font-size: 12px; white-space: nowrap;">Make Bigger</span>
                            <button class="control-btn" onclick="resetSelectedCells()">Reset Size</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="word-wall-container">
            <div class="custom-word-grid" id="customWordGrid">
                <!-- Grid will be populated by JavaScript -->
            </div>
        </div>

        <div class="practice-section">
            <h3>üöÄ Start Practice</h3>
            <div class="practice-buttons">
                <button class="practice-btn" onclick="startPractice('flashcards')">
                    üìö Flashcard Practice
                </button>
            </div>
        </div>
    </div>

    <!-- Practice Modal -->
    <div id="practiceModal" class="practice-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h2 id="practiceTitle">üìö Flashcard Practice</h2>
                </div>
                <div class="timer-controls">
                    <label class="timer-label">Timer (seconds):</label>
                    <input type="number" id="timerInput" class="timer-input" value="4" min="1" max="10" onchange="updateTimer()">
                    <button class="flash-toggle" id="flashToggle" onclick="toggleFlashMode()">‚ö° Flash Mode</button>
                    <button class="flash-toggle" id="ultraFlashToggle" onclick="toggleUltraFlashMode()">‚ö°‚ö° Ultra Flash</button>
                </div>
            </div>

            <div class="word-display">
                <div class="countdown-timer" id="countdownTimer">3</div>
                <div class="word-number" id="wordNumber">Word 1 of 100</div>
                <div class="current-word" id="currentWord">Click Next to start</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
            </div>

            <div class="practice-controls">
                <button class="control-btn" id="prevBtn" onclick="previousWord()">‚¨Ö Previous</button>
                <button class="control-btn" id="playBtn" onclick="playCurrentWord()">üîä Play</button>
                <button class="control-btn" id="nextBtn" onclick="nextWord()">Next ‚û°</button>
            </div>

            <div class="practice-controls">
                <button class="control-btn" onclick="restartPractice()">üîÑ Restart</button>
                <div class="order-control">
                    <label for="wordOrder" class="order-label">Word Order:</label>
                    <select id="wordOrder" class="order-dropdown" onchange="changeWordOrder()">
                        <option value="sequential">Sequential</option>
                        <option value="random">Random</option>
                    </select>
                </div>
                <button class="control-btn" onclick="closePractice()">‚úÖ Exit</button>
            </div>

            <div class="practice-controls">
                <button class="control-btn" onclick="practiceAll()">üîÑ All Words</button>
            </div>
        </div>
    </div>

    <div class="save-status" id="saveStatus">Saved!</div>
    
    <!-- Floating Text Controls -->
    <div class="floating-text-controls" id="floatingControls">
        <span>Text Size:</span>
        <button class="floating-btn" onclick="event.stopPropagation(); adjustSelectedCells(-2)">A-</button>
        <button class="floating-btn" onclick="event.stopPropagation(); adjustSelectedCells(2)">A+</button>
        <button class="floating-btn" onclick="event.stopPropagation(); resetSelectedCells()">Reset</button>
    </div>

    <!-- Workbook Import Modal -->
    <div id="workbookModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); min-width: 500px; max-width: 700px;">
            <div style="text-align: center; margin-bottom: 25px;">
                <h2 style="color: #4b0082; margin-bottom: 10px;">üìù Smart Text Import</h2>
                <p style="color: #666; font-size: 14px;">Copy and paste text from any source - words will be extracted automatically</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #4b0082; font-weight: bold; margin-bottom: 8px;">Paste Any Text Content:</label>
                <textarea id="workbookContent" placeholder="Paste text from Workbook pages, articles, word lists, or any source - words will be extracted automatically..." 
                         style="width: 100%; height: 200px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 14px; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #4b0082; font-weight: bold; margin-bottom: 8px;">Preview (First 10 words detected):</label>
                <div id="wordPreview" style="background: #f8f9fa; padding: 12px; border-radius: 8px; min-height: 40px; font-family: monospace; font-size: 14px; color: #666;">
                    Words will appear here as you paste content...
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="importButton" onclick="processWorkbookImport()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ‚úÖ Import Words
                </button>
                <button id="doneButton" onclick="closeWorkbookModal()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ‚úÖ Done
                </button>
            </div>
        </div>
    </div>

    <!-- Dictionary Modal -->
    <div id="dictionary-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 20000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); min-width: 400px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #4b0082; padding-bottom: 15px;">
                <h2 id="dictionary-header" style="color: #4b0082; margin: 0; font-size: 1.8rem;">Word Definition</h2>
                <button onclick="closeDictionary()" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 50%; font-size: 16px; cursor: pointer; line-height: 1;">√ó</button>
            </div>
            <div id="dictionary-body" style="color: #333; line-height: 1.6;">
                <div>Loading definition...</div>
            </div>
        </div>
    </div>

    <script>
        // Dictionary functionality
        let currentLanguage = "en"; // Default language is English

        // Dictionary functions
        function showDictionary(word) {
            const dictionaryModal = document.getElementById('dictionary-modal');
            const dictionaryHeader = document.querySelector('.dictionary-header');
            const dictionaryBody = document.querySelector('.dictionary-body');
            
            if (!dictionaryModal || !dictionaryHeader || !dictionaryBody) {
                console.error('Dictionary modal elements not found');
                return;
            }
            
            // Set the word as header
            dictionaryHeader.textContent = word;
            
            // Show loading message
            dictionaryBody.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Looking up definition...</div>';
            
            // Display the modal
            dictionaryModal.style.display = 'block';
            
            // Fetch dictionary definition
            fetchDefinition(word, currentLanguage)
                .then(definition => {
                    if (definition) {
                        dictionaryBody.innerHTML = formatDefinition(definition, currentLanguage);
                    } else {
                        dictionaryBody.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc3545;">No definition found for this word.</div>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching definition:', error);
                    dictionaryBody.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc3545;">Error looking up definition. Please try again later.</div>';
                });
        }

        function closeDictionary() {
            const dictionaryModal = document.getElementById('dictionary-modal');
            if (dictionaryModal) {
                dictionaryModal.style.display = 'none';
            }
        }

        async function fetchDefinition(word, language) {
            try {
                if (language === 'en') {
                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
                    if (!response.ok) {
                        return getBasicDefinition(word, language);
                    }
                    return await response.json();
                } else {
                    return getBasicDefinition(word, language);
                }
            } catch (error) {
                console.error('Dictionary API error:', error);
                return getBasicDefinition(word, language);
            }
        }

        function formatDefinition(definition, language) {
            if (language === 'en' && Array.isArray(definition)) {
                let formattedHTML = '';
                
                definition.forEach(entry => {
                    entry.meanings.forEach(meaning => {
                        formattedHTML += `<div style="margin-bottom: 15px;">`;
                        formattedHTML += `<div style="font-weight: bold; color: #4b0082; margin-bottom: 8px; text-transform: capitalize;">${meaning.partOfSpeech}</div>`;
                        
                        meaning.definitions.forEach((def, index) => {
                            if (index < 3) { // Limit to 3 definitions per part of speech
                                formattedHTML += `<div style="margin-bottom: 8px; padding-left: 15px;">`;
                                formattedHTML += `<strong>${index + 1}.</strong> ${def.definition}`;
                                if (def.example) {
                                    formattedHTML += `<br><em style="color: #666; font-size: 0.9em;">Example: "${def.example}"</em>`;
                                }
                                formattedHTML += `</div>`;
                            }
                        });
                        formattedHTML += `</div>`;
                    });
                });
                
                return formattedHTML;
            } else {
                return `<div style="padding: 20px; text-align: center;">${definition}</div>`;
            }
        }

        function getBasicDefinition(word, language) {
            const basicDefinitions = {
                'en': {
                    'cat': 'A small domesticated carnivorous mammal with soft fur, a short snout, and retractile claws.',
                    'dog': 'A domesticated carnivorous mammal that typically has a long snout, an acute sense of smell, and a barking voice.',
                    'house': 'A building for human habitation, especially one that is lived in by a family or small group of people.',
                    'tree': 'A woody perennial plant, typically having a main trunk and numerous branches.',
                    'water': 'A colorless, transparent, odorless liquid that forms the seas, lakes, rivers, and rain.',
                    'book': 'A written or printed work consisting of pages glued or sewn together along one side and bound in covers.',
                    'school': 'An institution for educating children or giving instruction in a particular subject.',
                    'friend': 'A person whom one knows and with whom one has a bond of mutual affection.',
                    'happy': 'Feeling or showing pleasure or contentment.',
                    'run': 'To move at a speed faster than a walk, never having both or all the feet on the ground at the same time.'
                }
            };
            
            const definitions = basicDefinitions[language] || basicDefinitions['en'];
            const lowerWord = word.toLowerCase();
            
            return definitions[lowerWord] || `A word meaning "${word}". Click on other words for more detailed definitions.`;
        }

        // Close dictionary when clicking outside or pressing Escape
        window.addEventListener('click', function(event) {
            const dictionaryModal = document.getElementById('dictionary-modal');
            if (event.target === dictionaryModal) {
                closeDictionary();
            }
        });

        document.addEventListener('keydown', function(event) {
            const dictionaryModal = document.getElementById('dictionary-modal');
            if (event.key === 'Escape' && dictionaryModal && dictionaryModal.style.display === 'block') {
                closeDictionary();
            }
        });

        // Global variables
        let columns = 6;
        let rows = 17;
        let maxRows = 17;
        let fontSize = 18;
        let customWords = Array(17).fill().map(() => Array(8).fill(''));
        let practiceWords = [];
        let originalWordOrder = [];
        let currentWordIndex = 0;
        let currentPracticeType = '';
        let timerSeconds = 4;
        let isFlashMode = false;
        let isUltraFlashMode = false;
        let currentTimer = null;
        let countdownInterval = null;
        let flashTimeout = null;
        let practiceMode = 'all';
        let selectedColumns = [];
        let selectedRows = [];
        let wordOrder = 'sequential';
        let currentListTitle = '';
        let savedLists = JSON.parse(localStorage.getItem('savedWordLists') || '{}');




        function changeColumns() {
            const selector = document.getElementById('columnSelector');
            const newColumns = parseInt(selector.value);
            
            // Save current words before changing grid
            const currentWords = [];
            for (let row = 0; row < rows; row++) {
                currentWords[row] = [];
                for (let col = 0; col < columns; col++) {
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cell) {
                        const input = cell.querySelector('.word-input');
                        currentWords[row][col] = input ? input.value : '';
                    } else {
                        currentWords[row][col] = customWords[row] && customWords[row][col] ? customWords[row][col] : '';
                    }
                }
            }
            
            // Update columns
            columns = newColumns;
            
            // Resize customWords array to match new column count
            for (let row = 0; row < rows; row++) {
                if (!customWords[row]) {
                    customWords[row] = Array(columns).fill('');
                } else {
                    // Preserve existing words and fill new columns with empty strings
                    const oldRow = [...currentWords[row]];
                    customWords[row] = Array(columns).fill('');
                    for (let col = 0; col < Math.min(oldRow.length, columns); col++) {
                        customWords[row][col] = oldRow[col] || '';
                    }
                }
            }
            
            // Clear selections when changing grid size
            selectedColumns = [];
            selectedRows = [];
            
            // Reinitialize the grid
            initializeGrid();
        }

        let selectedCells = new Set();

        function showFloatingControls() {
            document.getElementById('floatingControls').classList.add('show');
        }

        function hideFloatingControls() {
            document.getElementById('floatingControls').classList.remove('show');
        }

        function adjustSelectedCells(change) {
            if (selectedCells.size === 0) {
                return;
            }
            
            selectedCells.forEach(cell => {
                adjustCellFontSize(cell, change);
                // Ensure cell stays selected after adjustment
                cell.classList.add('font-selected');
            });
            // Keep floating controls visible
            showFloatingControls();
        }

        function resetSelectedCells() {
            if (selectedCells.size === 0) {
                return;
            }
            
            selectedCells.forEach(cell => {
                const textarea = cell.querySelector('textarea');
                if (textarea) {
                    textarea.style.fontSize = fontSize + 'px';
                }
                // Ensure cell stays selected after reset
                cell.classList.add('font-selected');
            });
            // Keep floating controls visible
            showFloatingControls();
        }

        // Global text size functions
        function adjustGlobalTextSize(change) {
            const allWordCells = document.querySelectorAll('.word-cell');
            
            allWordCells.forEach(cell => {
                const textarea = cell.querySelector('textarea');
                if (textarea) {
                    let currentSize = parseFloat(textarea.style.fontSize) || fontSize;
                    currentSize += change;
                    
                    if (currentSize < 8) currentSize = 8;   // Minimum font size
                    if (currentSize > 80) currentSize = 80; // Maximum font size
                    
                    textarea.style.fontSize = currentSize + 'px';
                }
            });
            
            // Show a temporary message
            showSaveStatus(`Global text size adjusted by ${change > 0 ? '+' : ''}${change}px`);
        }

        function resetGlobalTextSize() {
            const allWordCells = document.querySelectorAll('.word-cell');
            
            allWordCells.forEach(cell => {
                const textarea = cell.querySelector('textarea');
                if (textarea) {
                    textarea.style.fontSize = fontSize + 'px';
                }
            });
            
            // Show a temporary message
            showSaveStatus(`All text sizes reset to ${fontSize}px`);
        }

        function updateFontSize() {
            // Update display only - individual cells control their own font size
            document.getElementById('fontSizeDisplay').textContent = fontSize + 'px';
        }

        function adjustCellFontSize(cell, change) {
            const textarea = cell.querySelector('textarea');
            if (!textarea) return;
            
            let currentSize = parseFloat(textarea.style.fontSize) || fontSize;
            currentSize += change;
            
            if (currentSize < 8) currentSize = 8;   // Minimum font size
            if (currentSize > 80) currentSize = 80; // Maximum font size
            
            textarea.style.fontSize = currentSize + 'px';
            
            // Auto-scroll to show the cell being adjusted
            scrollToCell(cell);
        }

        function scrollToCell(cell) {
            const container = document.getElementById('customWordGrid');
            const containerRect = container.getBoundingClientRect();
            const cellRect = cell.getBoundingClientRect();
            
            // Check if cell is not fully visible
            const isAbove = cellRect.top < containerRect.top;
            const isBelow = cellRect.bottom > containerRect.bottom;
            
            if (isAbove || isBelow) {
                cell.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center',
                    inline: 'nearest'
                });
            }
        }

        // Add document click handler to hide floating controls
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.word-cell') && !e.target.closest('.floating-text-controls')) {
                selectedCells.forEach(c => c.classList.remove('font-selected'));
                selectedCells.clear();
                hideFloatingControls();
            }
        });

        // Initialize the grid
        function initializeGrid() {
            const grid = document.getElementById('customWordGrid');
            grid.innerHTML = '';
            
            // Set CSS variable for columns
            grid.style.setProperty('--columns', columns);
            
            // Create header row
            grid.appendChild(createGridElement('', 'grid-header'));
            for (let i = 1; i <= columns; i++) {
                const headerBtn = createGridElement(i, 'number-buttons selection-btn');
                headerBtn.onclick = (e) => toggleColumn(i - 1, e);
                grid.appendChild(headerBtn);
            }
            
            // Create rows
            for (let row = 0; row < rows; row++) {
                // Row header - use numbers for rows beyond Z
                let rowLabel;
                if (row < 26) {
                    rowLabel = String.fromCharCode(65 + row);
                } else {
                    rowLabel = (row + 1).toString();
                }
                
                const rowBtn = createGridElement(rowLabel, 'letter-buttons selection-btn');
                rowBtn.onclick = (e) => toggleRow(row, e);
                grid.appendChild(rowBtn);
                
                // Word cells
                for (let col = 0; col < columns; col++) {
                    const cell = createWordCell(row, col);
                    grid.appendChild(cell);
                }
            }
            
            loadSavedWords();
        }

        function createGridElement(text, className) {
            const element = document.createElement('div');
            element.textContent = text;
            element.className = className;
            return element;
        }

        function createWordCell(row, col) {
            const cell = document.createElement('div');
            cell.className = 'word-cell';
            cell.dataset.row = row;
            cell.dataset.col = col;
            
            const input = document.createElement('textarea');
            input.className = 'word-input';
            input.placeholder = '';
            input.maxLength = 25;
            input.value = customWords[row][col];
            input.rows = 2;
            input.style.fontSize = fontSize + 'px';
            
            input.addEventListener('focus', () => {
                cell.classList.add('editing');
                // Auto-select cell when focusing
                selectedCells.forEach(c => c.classList.remove('font-selected'));
                selectedCells.clear();
                selectedCells.add(cell);
                cell.classList.add('font-selected');
                showFloatingControls();
            });
            
            input.addEventListener('blur', () => {
                cell.classList.remove('editing');
                customWords[row][col] = input.value.trim();
                updateCellAppearance(cell, input.value.trim());
                saveWords();
                // Keep selection active after blur to maintain floating controls
            });
            
            input.addEventListener('input', () => {
                const text = input.value;
                // If word is longer than 12 characters, add line breaks every 12 characters
                if (text.length > 12 && !text.includes('\n')) {
                    let formattedText = '';
                    for (let i = 0; i < text.length; i += 12) {
                        if (i > 0) formattedText += '\n';
                        formattedText += text.substring(i, i + 12);
                    }
                    const cursorPos = input.selectionStart;
                    input.value = formattedText;
                    input.setSelectionRange(cursorPos, cursorPos);
                }
                customWords[row][col] = input.value.trim();
                updateCellAppearance(cell, input.value.trim());
            });
            
            // Add keyboard shortcut for dictionary (Ctrl+D or Cmd+D)
            input.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    const word = input.value.trim();
                    if (word !== '') {
                        showDictionary(word);
                    }
                }
            });

            // Add right-click context menu for dictionary
            cell.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                const word = input.value.trim();
                if (word !== '') {
                    showDictionary(word);
                }
            });

            cell.addEventListener('click', (e) => {
                if (input.value.trim() !== '') {
                    speakWord(input.value.trim());
                }
                
                // Handle cell selection for font sizing
                e.stopPropagation();
                if (e.shiftKey) {
                    // Multi-select with Shift
                    if (selectedCells.has(cell)) {
                        selectedCells.delete(cell);
                        cell.classList.remove('font-selected');
                    } else {
                        selectedCells.add(cell);
                        cell.classList.add('font-selected');
                    }
                } else {
                    // Single select
                    selectedCells.forEach(c => c.classList.remove('font-selected'));
                    selectedCells.clear();
                    selectedCells.add(cell);
                    cell.classList.add('font-selected');
                }
                
                // Show floating controls when cells are selected
                if (selectedCells.size > 0) {
                    showFloatingControls();
                } else {
                    hideFloatingControls();
                }
            });
            
            input.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                if (input.value.trim() !== '') {
                    speakWord(input.value.trim());
                }
            });
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                }
            });
            
            input.addEventListener('input', () => {
                customWords[row][col] = input.value.trim();
                updateCellAppearance(cell, input.value.trim());
            });
            
            cell.appendChild(input);
            updateCellAppearance(cell, customWords[row][col]);
            
            return cell;
        }

        function updateCellAppearance(cell, value) {
            if (value === '') {
                cell.classList.add('empty');
                cell.classList.remove('has-word');
            } else {
                cell.classList.remove('empty');
                cell.classList.add('has-word');
            }
        }





        function refreshGrid() {
            const inputs = document.querySelectorAll('.word-input');
            inputs.forEach((input, index) => {
                const row = Math.floor(index / columns);
                const col = index % columns;
                if (row < rows && col < columns && customWords[row] && customWords[row][col] !== undefined) {
                    input.value = customWords[row][col];
                    updateCellAppearance(input.parentElement, customWords[row][col]);
                }
            });
        }



        function clearAllWords() {
            if (confirm('Are you sure you want to clear all words? This cannot be undone.')) {
                clearAllWordsSilently();
                showSaveStatus('All words cleared successfully!');
            }
        }

        function clearAllWordsSilently() {
            // Clear the entire customWords array for all possible column configurations (up to 8 columns max)
            customWords = Array(17).fill().map(() => Array(8).fill(''));
            
            // Clear all input fields in the current grid
            const wordInputs = document.querySelectorAll('.word-input');
            wordInputs.forEach(input => {
                input.value = '';
            });
            
            // Clear localStorage to remove any cached data
            localStorage.removeItem('customWords');
        }

        // Save/Load functions
        function saveWords() {
            localStorage.setItem('customWords', JSON.stringify(customWords));
        }

        function loadSavedWords() {
            const saved = localStorage.getItem('customWords');
            if (saved) {
                const savedData = JSON.parse(saved);
                // Ensure saved data fits new grid dimensions
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < columns; col++) {
                        if (savedData[row] && savedData[row][col]) {
                            customWords[row][col] = savedData[row][col];
                        }
                    }
                }
                refreshGrid();
            }
        }

        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 2000);
        }



        // Selection functions
        function toggleColumn(columnIndex, event) {
            if (event.shiftKey) {
                const index = selectedColumns.indexOf(columnIndex);
                const button = event.target;
                
                if (index === -1) {
                    selectedColumns.push(columnIndex);
                    button.classList.add('selected');
                } else {
                    selectedColumns.splice(index, 1);
                    button.classList.remove('selected');
                }
                
                selectedRows = [];
                document.querySelectorAll('.letter-buttons').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                practiceMode = selectedColumns.length > 0 ? 'multi' : 'all';
                updateWordVisibility();
            } else {
                clearAllSelections();
                selectedColumns = [columnIndex];
                event.target.classList.add('selected');
                practiceMode = 'column';
                updateWordVisibility();
            }
        }

        function toggleRow(rowIndex, event) {
            if (event.shiftKey) {
                const index = selectedRows.indexOf(rowIndex);
                const button = event.target;
                
                if (index === -1) {
                    selectedRows.push(rowIndex);
                    button.classList.add('selected');
                } else {
                    selectedRows.splice(index, 1);
                    button.classList.remove('selected');
                }
                
                selectedColumns = [];
                document.querySelectorAll('.number-buttons').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                practiceMode = selectedRows.length > 0 ? 'multi' : 'all';
                updateWordVisibility();
            } else {
                clearAllSelections();
                selectedRows = [rowIndex];
                event.target.classList.add('selected');
                practiceMode = 'row';
                updateWordVisibility();
            }
        }

        function clearAllSelections() {
            selectedColumns = [];
            selectedRows = [];
            document.querySelectorAll('.selection-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        function updateWordVisibility() {
            const wordCells = document.querySelectorAll('.word-cell');
            
            if (practiceMode === 'all') {
                wordCells.forEach(cell => cell.classList.remove('hidden'));
            } else if (practiceMode === 'column' || (practiceMode === 'multi' && selectedColumns.length > 0)) {
                wordCells.forEach(cell => {
                    const col = parseInt(cell.dataset.col);
                    if (selectedColumns.includes(col)) {
                        cell.classList.remove('hidden');
                    } else {
                        cell.classList.add('hidden');
                    }
                });
            } else if (practiceMode === 'row' || (practiceMode === 'multi' && selectedRows.length > 0)) {
                wordCells.forEach(cell => {
                    const row = parseInt(cell.dataset.row);
                    if (selectedRows.includes(row)) {
                        cell.classList.remove('hidden');
                    } else {
                        cell.classList.add('hidden');
                    }
                });
            }
        }

        function showAllWords() {
            clearAllSelections();
            practiceMode = 'all';
            updateWordVisibility();
        }

        // Practice functions

        function startPractice(type) {
            currentPracticeType = type;
            currentWordIndex = 0;
            
            practiceWords = [];
            
            if (practiceMode === 'column' || (practiceMode === 'multi' && selectedColumns.length > 0)) {
                for (let col of selectedColumns) {
                    for (let row = 0; row < rows; row++) {
                        if (customWords[row][col].trim() !== '') {
                            practiceWords.push(customWords[row][col].trim());
                        }
                    }
                }
            } else if (practiceMode === 'row' || (practiceMode === 'multi' && selectedRows.length > 0)) {
                for (let row of selectedRows) {
                    for (let col = 0; col < columns; col++) {
                        if (customWords[row][col].trim() !== '') {
                            practiceWords.push(customWords[row][col].trim());
                        }
                    }
                }
            } else {
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < columns; col++) {
                        if (customWords[row][col].trim() !== '') {
                            practiceWords.push(customWords[row][col].trim());
                        }
                    }
                }
            }
            
            if (practiceWords.length === 0) {
                alert('No words to practice! Please add some words first.');
                return;
            }
            
            originalWordOrder = [...practiceWords];
            
            const dropdown = document.getElementById('wordOrder');
            if (dropdown && dropdown.value === 'random') {
                for (let i = practiceWords.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [practiceWords[i], practiceWords[j]] = [practiceWords[j], practiceWords[i]];
                }
            }
            
            const titles = {
                'flashcards': isFlashMode ? '‚ö° Flash Mode Practice' : 'üìö Flashcard Practice'
            };
            
            document.getElementById('practiceTitle').textContent = titles[type];
            document.getElementById('practiceModal').style.display = 'block';
            
            updatePracticeDisplay();
        }

        function updatePracticeDisplay() {
            const wordNumber = document.getElementById('wordNumber');
            const currentWord = document.getElementById('currentWord');
            const progressFill = document.getElementById('progressFill');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            wordNumber.textContent = `Word ${currentWordIndex + 1} of ${practiceWords.length}`;
            currentWord.textContent = practiceWords[currentWordIndex];
            
            const progress = ((currentWordIndex + 1) / practiceWords.length) * 100;
            progressFill.style.width = progress + '%';
            
            prevBtn.disabled = currentWordIndex === 0;
            nextBtn.disabled = currentWordIndex === practiceWords.length - 1;
            
            prevBtn.style.opacity = currentWordIndex === 0 ? '0.5' : '1';
            nextBtn.style.opacity = currentWordIndex === practiceWords.length - 1 ? '0.5' : '1';
            
            stopTimer();
            
            if (currentPracticeType === 'flashcards') {
                startWordTimer();
            }
        }

        function nextWord() {
            // Stop any ongoing speech and timers immediately
            stopTimer();
            speechSynthesis.cancel();
            
            if (currentWordIndex < practiceWords.length - 1) {
                currentWordIndex++;
                updatePracticeDisplay();
            }
        }

        function previousWord() {
            // Stop any ongoing speech and timers immediately
            stopTimer();
            speechSynthesis.cancel();
            
            if (currentWordIndex > 0) {
                currentWordIndex--;
                updatePracticeDisplay();
            }
        }

        function updateTimer() {
            const input = document.getElementById('timerInput');
            timerSeconds = parseInt(input.value);
            if (timerSeconds < 1) timerSeconds = 1;
            if (timerSeconds > 10) timerSeconds = 10;
            input.value = timerSeconds;
        }

        function toggleFlashMode() {
            isFlashMode = !isFlashMode;
            const toggle = document.getElementById('flashToggle');
            const ultraToggle = document.getElementById('ultraFlashToggle');
            
            if (isFlashMode) {
                // Disable Ultra Flash when Flash is enabled
                isUltraFlashMode = false;
                ultraToggle.textContent = '‚ö°‚ö° Ultra Flash';
                ultraToggle.classList.remove('active');
                
                toggle.textContent = '‚ö° Flash ON (300ms)';
                toggle.classList.add('active');
            } else {
                toggle.textContent = '‚ö° Flash Mode';
                toggle.classList.remove('active');
            }
        }

        function toggleUltraFlashMode() {
            isUltraFlashMode = !isUltraFlashMode;
            const ultraToggle = document.getElementById('ultraFlashToggle');
            const toggle = document.getElementById('flashToggle');
            
            if (isUltraFlashMode) {
                // Disable Flash when Ultra Flash is enabled
                isFlashMode = false;
                toggle.textContent = '‚ö° Flash Mode';
                toggle.classList.remove('active');
                
                ultraToggle.textContent = '‚ö°‚ö° Ultra ON (200ms)';
                ultraToggle.classList.add('active');
            } else {
                ultraToggle.textContent = '‚ö°‚ö° Ultra Flash';
                ultraToggle.classList.remove('active');
            }
        }

        function startWordTimer() {
            // Clear ALL existing timers and intervals
            clearTimeout(currentTimer);
            clearTimeout(flashTimeout);
            clearInterval(countdownInterval);
            
            const countdownElement = document.getElementById('countdownTimer');
            const wordElement = document.getElementById('currentWord');
            
            if (isFlashMode || isUltraFlashMode) {
                wordElement.style.visibility = 'visible';
                wordElement.style.opacity = '1';
                
                // Set flash duration based on mode - 200ms for Ultra Flash, 300ms for regular Flash
                const flashDuration = isUltraFlashMode ? 200 : 300;
                
                flashTimeout = setTimeout(() => {
                    // Check if this timeout is still valid (not cancelled by rapid clicking)
                    if (flashTimeout === null) return;
                    
                    wordElement.style.visibility = 'hidden';
                    
                    let countdown = timerSeconds;
                    countdownElement.style.display = 'flex';
                    countdownElement.textContent = countdown;
                    
                    countdownInterval = setInterval(() => {
                        // Check if this interval is still valid
                        if (countdownInterval === null) return;
                        
                        countdown--;
                        countdownElement.textContent = countdown;
                        
                        if (countdown <= 0) {
                            clearInterval(countdownInterval);
                            countdownInterval = null;
                            countdownElement.style.display = 'none';
                            speakWord(practiceWords[currentWordIndex]);
                        }
                    }, 1000);
                }, flashDuration);
            } else {
                wordElement.style.visibility = 'visible';
                let countdown = timerSeconds;
                countdownElement.style.display = 'flex';
                countdownElement.textContent = countdown;
                
                countdownInterval = setInterval(() => {
                    // Check if this interval is still valid
                    if (countdownInterval === null) return;
                    
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        countdownInterval = null;
                        countdownElement.style.display = 'none';
                        speakWord(practiceWords[currentWordIndex]);
                    }
                }, 1000);
            }
        }

        function stopTimer() {
            clearTimeout(currentTimer);
            clearTimeout(flashTimeout);
            clearInterval(countdownInterval);
            
            // Set timer variables to null to invalidate any pending callbacks
            currentTimer = null;
            flashTimeout = null;
            countdownInterval = null;
            
            // Cancel any ongoing speech synthesis
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
            
            const countdownElement = document.getElementById('countdownTimer');
            const wordElement = document.getElementById('currentWord');
            
            countdownElement.style.display = 'none';
            wordElement.style.visibility = 'visible';
            wordElement.style.opacity = '1';
        }

        function playCurrentWord() {
            const word = practiceWords[currentWordIndex];
            speakWord(word);
        }

        function restartPractice() {
            currentWordIndex = 0;
            
            const dropdown = document.getElementById('wordOrder');
            if (dropdown && dropdown.value === 'random') {
                practiceWords = [...originalWordOrder];
                for (let i = practiceWords.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [practiceWords[i], practiceWords[j]] = [practiceWords[j], practiceWords[i]];
                }
            } else {
                practiceWords = [...originalWordOrder];
            }
            
            updatePracticeDisplay();
        }

        function changeWordOrder() {
            const dropdown = document.getElementById('wordOrder');
            wordOrder = dropdown.value;
            
            if (wordOrder === 'random') {
                for (let i = practiceWords.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [practiceWords[i], practiceWords[j]] = [practiceWords[j], practiceWords[i]];
                }
            } else {
                practiceWords = [...originalWordOrder];
            }
            
            currentWordIndex = 0;
            updatePracticeDisplay();
        }

        function practiceAll() {
            practiceMode = 'all';
            practiceWords = [];
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < columns; col++) {
                    if (customWords[row][col].trim() !== '') {
                        practiceWords.push(customWords[row][col].trim());
                    }
                }
            }
            originalWordOrder = [...practiceWords];
            currentWordIndex = 0;
            updatePracticeDisplay();
        }

        function closePractice() {
            stopTimer();
            speechSynthesis.cancel();
            document.getElementById('practiceModal').style.display = 'none';
            practiceMode = 'all';
            
            // Reset flash mode state when closing
            if (isFlashMode) {
                const wordElement = document.getElementById('currentWord');
                wordElement.style.visibility = 'visible';
                wordElement.style.opacity = '1';
            }
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                // Force cancel any existing speech first
                speechSynthesis.cancel();
                
                // Add a small delay to ensure cancellation is processed
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.rate = 0.8;
                    utterance.pitch = 1;
                    utterance.volume = 1;
                    
                    // Add safety check to prevent multiple simultaneous speech
                    if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                        speechSynthesis.speak(utterance);
                    }
                }, 50);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('practiceModal');
            if (event.target === modal) {
                closePractice();
            }
        }

        // Clear font selection when clicking outside cells (but not on font controls)
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.word-cell') && !e.target.closest('.control-section')) {
                selectedCells.forEach(c => c.classList.remove('font-selected'));
                selectedCells.clear();
            }
        });

        // Word List Manager Functions
        function updateListTitle() {
            currentListTitle = document.getElementById('listTitle').value.trim();
        }

        function saveCurrentList() {
            const title = document.getElementById('listTitle').value.trim();
            if (!title) {
                alert('Please enter a name for your word list!');
                return;
            }
            
            // Create save data object
            const listData = {
                title: title,
                words: customWords,
                columns: columns,
                rows: rows,
                fontSize: fontSize,
                savedDate: new Date().toISOString()
            };
            
            // Save to localStorage
            savedLists[title] = listData;
            localStorage.setItem('savedWordLists', JSON.stringify(savedLists));
            
            // Update dropdown and show success
            updateSavedListsDropdown();
            showSaveStatus('Word list "' + title + '" saved successfully!');
        }

        function loadSelectedList() {
            const dropdown = document.getElementById('savedListsDropdown');
            const selectedTitle = dropdown.value;
            
            if (!selectedTitle || !savedLists[selectedTitle]) {
                return;
            }
            
            const listData = savedLists[selectedTitle];
            
            // Load the data - ensure proper deep copy of words array
            customWords = listData.words.map(row => [...row]);
            columns = listData.columns || 6;
            rows = listData.rows || 16;
            fontSize = listData.fontSize || 18;
            currentListTitle = listData.title;
            
            // Update UI elements
            document.getElementById('listTitle').value = listData.title;
            document.getElementById('columnSelector').value = columns;
            
            // Refresh the grid completely
            const gridContainer = document.querySelector('.custom-word-grid');
            gridContainer.innerHTML = '';
            initializeGrid();
            
            // Update all input values after grid creation
            setTimeout(() => {
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < columns; col++) {
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        if (cell) {
                            const input = cell.querySelector('.word-input');
                            if (input && customWords[row] && customWords[row][col]) {
                                input.value = customWords[row][col];
                            }
                        }
                    }
                }
            }, 100);
            
            showSaveStatus('Word list "' + selectedTitle + '" loaded successfully!');
        }

        function deleteSelectedList() {
            const dropdown = document.getElementById('savedListsDropdown');
            const selectedTitle = dropdown.value;
            
            if (!selectedTitle) {
                alert('Please select a word list to delete!');
                return;
            }
            
            if (confirm('Are you sure you want to delete "' + selectedTitle + '"? This cannot be undone.')) {
                delete savedLists[selectedTitle];
                localStorage.setItem('savedWordLists', JSON.stringify(savedLists));
                updateSavedListsDropdown();
                document.getElementById('savedListsDropdown').value = '';
                showSaveStatus('Word list "' + selectedTitle + '" deleted successfully!');
            }
        }

        function updateSavedListsDropdown() {
            const dropdown = document.getElementById('savedListsDropdown');
            
            // Clear existing options except the first one
            dropdown.innerHTML = '<option value="">-- Select a saved list --</option>';
            
            // Add saved lists
            Object.keys(savedLists).sort().forEach(title => {
                const option = document.createElement('option');
                option.value = title;
                option.textContent = title + ' (' + new Date(savedLists[title].savedDate).toLocaleDateString() + ')';
                dropdown.appendChild(option);
            });
        }

        function showSaveStatus(message) {
            // Use existing save status element
            const status = document.getElementById('saveStatus');
            if (status) {
                status.textContent = message;
                status.style.display = 'block';
                status.style.opacity = '1';
                setTimeout(() => {
                    status.style.opacity = '0';
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 300);
                }, 3000);
            }
        }

        // Export/Import functions
        function showExportOptions() {
            const wordsToExport = [];
            
            // Build the export data structure matching the grid
            for (let row = 0; row < maxRows; row++) {
                const rowData = [];
                for (let col = 0; col < columns; col++) {
                    const word = customWords[row] && customWords[row][col] ? customWords[row][col].trim() : '';
                    rowData.push(word);
                }
                wordsToExport.push(rowData);
            }
            
            // Check if there are any words to export
            const hasWords = wordsToExport.some(row => row.some(word => word !== ''));
            if (!hasWords) {
                alert('No words to export!');
                return;
            }
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(wordsToExport));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "word-wall.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            downloadAnchor.remove();
        }

        function importWords() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (file.name.endsWith('.json')) {
                        const importedWords = JSON.parse(content);
                        loadImportedWords(importedWords);
                    } else if (file.name.endsWith('.pdf')) {
                        // Handle PDF files - extract readable text and process as word list
                        processPDFContent(content);
                    } else {
                        // Handle text files (.txt, .csv)
                        // Debug: Log the raw content to see what we're working with
                        console.log('Raw file content:', content);
                        
                        // Split on line breaks first, then handle any remaining whitespace
                        const lines = content.split(/[\r\n]+/);
                        const wordsList = [];
                        
                        for (let line of lines) {
                            const lineWords = line.split(/[\s,\t]+/).filter(word => word.trim() !== '');
                            wordsList.push(...lineWords);
                        }
                        
                        console.log('Processed words list:', wordsList);
                        loadWordsAsList(wordsList);
                    }
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            
            // Use readAsText for PDF files as well to extract any readable content
            reader.readAsText(file);
        }

        function processPDFContent(content) {
            // PDF text extraction through FileReader often produces garbled results
            // Show helpful message and provide alternative solution
            alert('PDF text extraction produced unclear results. For best results:\n\n1. Open your PDF file\n2. Select and copy all the text (Ctrl+A, then Ctrl+C)\n3. Paste into a text editor like Notepad\n4. Save as a .txt file\n5. Import the .txt file instead\n\nAlternatively, use the pre-created 100-sight-words.txt file available in the demo.');
            return;
        }

        function loadImportedWords(importedWords) {
            // Clear existing words first
            clearAllWordsSilently();
            
            for (let row = 0; row < Math.min(maxRows, importedWords.length); row++) {
                if (!customWords[row]) customWords[row] = [];
                for (let col = 0; col < Math.min(columns, importedWords[row].length); col++) {
                    const word = importedWords[row][col] || '';
                    customWords[row][col] = word;
                    
                    // Update the cell display
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cell) {
                        const input = cell.querySelector('.word-input');
                        if (input) {
                            input.value = word;
                        }
                    }
                }
            }
            
            saveToLocalStorage();
            showSaveStatus();
        }

        function loadWordsAsList(wordsList) {
            // Clear existing words first
            clearAllWordsSilently();
            
            // Additional filtering to ensure clean word separation
            const cleanWords = [];
            for (let word of wordsList) {
                const trimmed = word.trim();
                if (trimmed.length > 0 && trimmed.length < 20 && /^[a-zA-Z]+$/.test(trimmed)) {
                    cleanWords.push(trimmed);
                }
            }
            
            let wordIndex = 0;
            
            for (let row = 0; row < maxRows && wordIndex < cleanWords.length; row++) {
                if (!customWords[row]) customWords[row] = [];
                for (let col = 0; col < columns && wordIndex < cleanWords.length; col++) {
                    const word = cleanWords[wordIndex];
                    customWords[row][col] = word;
                    
                    // Update the cell display
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cell) {
                        const input = cell.querySelector('.word-input');
                        if (input) {
                            input.value = word;
                            // Trigger update event to refresh display
                            const event = new Event('input', { bubbles: true });
                            input.dispatchEvent(event);
                        }
                    }
                    
                    wordIndex++;
                }
            }
            
            saveToLocalStorage();
            showSaveStatus();
            
            // Show import success message
            alert(`Successfully imported ${cleanWords.length} words into the grid!`);
        }

        // Workbook Import Functions
        function showWorkbookImport() {
            document.getElementById('workbookModal').style.display = 'block';
            document.getElementById('workbookContent').value = '';
            document.getElementById('wordPreview').innerHTML = 'Words will appear here as you paste content...';
            
            // Reset buttons to initial state
            const importButton = document.getElementById('importButton');
            const doneButton = document.getElementById('doneButton');
            
            importButton.style.display = 'inline-block';
            importButton.innerHTML = '‚úÖ Import Words';
            doneButton.innerHTML = '‚úÖ Done';
            
            // Add real-time preview
            document.getElementById('workbookContent').addEventListener('input', updateWorkbookPreview);
        }

        function closeWorkbookModal() {
            document.getElementById('workbookModal').style.display = 'none';
            document.getElementById('workbookContent').removeEventListener('input', updateWorkbookPreview);
        }

        function updateWorkbookPreview() {
            const content = document.getElementById('workbookContent').value;
            const words = extractWordsFromWorkbookContent(content);
            const preview = words.slice(0, 10).join(', ');
            const previewEl = document.getElementById('wordPreview');
            
            if (words.length === 0) {
                previewEl.innerHTML = 'No words detected yet...';
                previewEl.style.color = '#999';
            } else {
                previewEl.innerHTML = `${preview}${words.length > 10 ? '...' : ''} <br><small style="color: #28a745; font-weight: bold;">${words.length} words detected total</small>`;
                previewEl.style.color = '#333';
            }
        }

        function extractWordsFromWorkbookContent(content) {
            if (!content.trim()) return [];
            
            // First try to extract just the words by looking for numbered patterns
            let words = [];
            
            // Pattern 1: Look for numbered word lists (1. word, 2. word, etc.)
            const numberedPattern = /\d+\.\s*([a-zA-Z]+)/g;
            let match;
            while ((match = numberedPattern.exec(content)) !== null) {
                words.push(match[1].trim());
            }
            
            // Pattern 2: If numbered pattern doesn't work, try splitting by common separators
            if (words.length === 0) {
                // Split by various delimiters and filter for valid words
                const rawWords = content
                    .split(/[\n\r\t,;|]+/)
                    .map(word => word.replace(/^\d+\.?\s*/, '').trim()) // Remove numbers
                    .filter(word => /^[a-zA-Z]+$/.test(word)) // Only alphabetic words
                    .filter(word => word.length >= 2 && word.length <= 15); // Reasonable word length
                
                words = rawWords;
            }
            
            // Pattern 3: If still no luck, extract all alphabetic sequences
            if (words.length === 0) {
                const allWords = content.match(/\b[a-zA-Z]{2,15}\b/g) || [];
                // Filter out common non-word text
                const filtered = allWords.filter(word => 
                    !['the', 'and', 'or', 'but', 'page', 'syllable', 'word', 'words', 'one', 'two', 'three', 'four'].includes(word.toLowerCase())
                );
                words = filtered;
            }
            
            // Remove duplicates and limit to 30 words (typical Workbook page size)
            const uniqueWords = [...new Set(words)];
            return uniqueWords.slice(0, 30);
        }

        function processWorkbookImport() {
            const content = document.getElementById('workbookContent').value;
            const words = extractWordsFromWorkbookContent(content);
            
            if (words.length === 0) {
                alert('No valid words found in the pasted content. Please make sure you copied the words from a Workbook page.');
                return;
            }
            
            if (words.length > 30) {
                if (!confirm(`Found ${words.length} words. Only the first 30 will be imported. Continue?`)) {
                    return;
                }
            }
            
            // Clear the grid silently (without confirmation popup)
            clearAllWordsSilently();
            
            // Import words sequentially into the grid
            let wordIndex = 0;
            for (let row = 0; row < maxRows && wordIndex < words.length; row++) {
                if (!customWords[row]) customWords[row] = [];
                for (let col = 0; col < columns && wordIndex < words.length; col++) {
                    const word = words[wordIndex];
                    customWords[row][col] = word;
                    
                    // Update the cell display
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cell) {
                        const input = cell.querySelector('.word-input');
                        if (input) {
                            input.value = word;
                            // Trigger update event to refresh display
                            const event = new Event('input', { bubbles: true });
                            input.dispatchEvent(event);
                        }
                    }
                    
                    wordIndex++;
                }
            }
            
            saveToLocalStorage();
            showSaveStatus();
            
            // Change buttons to show completion
            const importButton = document.getElementById('importButton');
            const doneButton = document.getElementById('doneButton');
            
            importButton.style.display = 'none';
            doneButton.innerHTML = '‚úÖ Completed';
            
            // Show success message in the modal
            const previewEl = document.getElementById('wordPreview');
            previewEl.innerHTML = `<span style="color: #28a745; font-weight: bold;">‚úÖ SUCCESS: ${words.length} words imported successfully!</span>`;
        }

        // Dictionary functions
        function showDictionary(word) {
            const modal = document.getElementById('dictionary-modal');
            const header = document.getElementById('dictionary-header');
            const body = document.getElementById('dictionary-body');
            
            header.textContent = word;
            body.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Looking up definition...</div>';
            modal.style.display = 'block';
            
            fetchDefinition(word).then(definition => {
                body.innerHTML = definition;
            });
        }

        function closeDictionary() {
            document.getElementById('dictionary-modal').style.display = 'none';
        }

        async function fetchDefinition(word) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if (response.ok) {
                    const data = await response.json();
                    return formatDefinition(data);
                }
            } catch (error) {
                console.log('API error, using basic definition');
            }
            return getBasicDefinition(word);
        }

        function formatDefinition(data) {
            let html = '';
            data[0].meanings.forEach(meaning => {
                html += `<div style="margin-bottom: 15px;">`;
                html += `<div style="font-weight: bold; color: #4b0082; margin-bottom: 8px;">${meaning.partOfSpeech}</div>`;
                meaning.definitions.slice(0, 2).forEach((def, i) => {
                    html += `<div style="margin-bottom: 8px; padding-left: 15px;">`;
                    html += `<strong>${i + 1}.</strong> ${def.definition}`;
                    if (def.example) {
                        html += `<br><em style="color: #666; font-size: 0.9em;">Example: "${def.example}"</em>`;
                    }
                    html += `</div>`;
                });
                html += `</div>`;
            });
            return html;
        }

        function getBasicDefinition(word) {
            const definitions = {
                'cat': 'A small domesticated carnivorous mammal with soft fur.',
                'dog': 'A domesticated carnivorous mammal, typically kept as a pet.',
                'house': 'A building for human habitation.',
                'tree': 'A woody perennial plant with a trunk and branches.',
                'water': 'A colorless, transparent, odorless liquid.',
                'book': 'A written or printed work consisting of pages.',
                'school': 'An institution for educating children.',
                'friend': 'A person whom one knows and likes.',
                'happy': 'Feeling or showing pleasure or contentment.',
                'run': 'Move at a speed faster than a walk.'
            };
            
            return definitions[word.toLowerCase()] || `"${word}" - Click the word in a sentence or look it up in a dictionary for the full definition.`;
        }

        // Close dictionary when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('dictionary-modal');
            if (event.target === modal) {
                closeDictionary();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeGrid();
            updateSavedListsDropdown();
        });
    </script>
</body>
</html>